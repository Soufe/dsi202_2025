{% extends 'base.html' %}
{% load static %}

{% block title %}‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ | PLOOKJING{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto p-6">
  <h1 class="text-3xl font-bold text-green-700 mb-6">üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h1>

  <!-- ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ -->
  <div class="mb-10">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-2xl font-semibold text-green-800">üå≥ ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ</h2>
      <label class="flex items-center space-x-2">
        <input type="checkbox" id="select-all-trees" class="form-checkbox h-5 w-5 text-green-500">
        <span class="text-sm text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ)</span>
      </label>
    </div>
    <div class="grid gap-4">
      {% for item in cart.tree_items %}
      <div class="bg-white rounded-xl shadow-md flex items-center p-4 space-x-4">
        <input type="checkbox" name="selected_tree" value="{{ item.id }}" class="tree-checkbox h-5 w-5 text-green-500">
        <img src="{{ item.image.url }}" alt="{{ item.name }}" class="w-24 h-24 object-cover rounded-lg border">
        <div class="flex-1">
          <h3 class="text-lg font-medium text-green-700">{{ item.name }}</h3>
          <p class="text-sm text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤: ‡∏ø{{ item.price|floatformat:2 }}</p>
        </div>
        <div class="flex items-center space-x-2">
          <button class="bg-gray-200 px-2 py-1 rounded">‚àí</button>
          <span class="w-6 text-center">{{ item.quantity }}</span>
          <button class="bg-gray-200 px-2 py-1 rounded">+</button>
        </div>
        <form method="post" action="{% url 'remove_from_cart' item.id %}">
          {% csrf_token %}
          <button type="submit" class="text-red-500 hover:underline">‡∏•‡∏ö</button>
        </form>
      </div>
      {% empty %}
      <p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
      {% endfor %}
    </div>
  </div>

  <!-- ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå -->
  <div class="mb-10">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-2xl font-semibold text-orange-700">üõ† ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h2>
      <label class="flex items-center space-x-2">
        <input type="checkbox" id="select-all-equipment" class="form-checkbox h-5 w-5 text-orange-500">
        <span class="text-sm text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå)</span>
      </label>
    </div>
    <div class="grid gap-4">
      {% for item in cart.equipment_items %}
      <div class="bg-white rounded-xl shadow-md flex items-center p-4 space-x-4">
        <input type="checkbox" name="selected_equipment" value="{{ item.id }}" class="equipment-checkbox h-5 w-5 text-orange-500">
        <img src="{{ item.image.url }}" alt="{{ item.name }}" class="w-24 h-24 object-cover rounded-lg border">
        <div class="flex-1">
          <h3 class="text-lg font-medium text-orange-700">{{ item.name }}</h3>
          <p class="text-sm text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤: ‡∏ø{{ item.price|floatformat:2 }}</p>
        </div>
        <div class="flex items-center space-x-2">
          <button class="bg-gray-200 px-2 py-1 rounded">‚àí</button>
          <span class="w-6 text-center">{{ item.quantity }}</span>
          <button class="bg-gray-200 px-2 py-1 rounded">+</button>
        </div>
        <form method="post" action="{% url 'remove_from_cart' item.id %}">
          {% csrf_token %}
          <button type="submit" class="text-red-500 hover:underline">‡∏•‡∏ö</button>
        </form>
      </div>
      {% empty %}
      <p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
      {% endfor %}
    </div>
  </div>

  <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏Ñ‡∏≤ -->
  <div class="bg-gray-50 p-6 rounded-xl shadow-inner flex flex-col md:flex-row justify-between items-center">
    <div class="text-lg text-gray-700">
      ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:
      <span id="total-selected" class="text-2xl font-bold text-green-700 ml-2">‡∏ø0.00</span>
    </div>
    <form method="post" action="{% url 'checkout' %}" class="mt-4 md:mt-0">
      {% csrf_token %}
      <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-xl font-semibold">
        ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
      </button>
    </form>
  </div>
</div>

<!-- ‚úÖ JavaScript ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -->
<script>
  const treeCheckboxes = document.querySelectorAll('.tree-checkbox');
  const equipmentCheckboxes = document.querySelectorAll('.equipment-checkbox');
  const selectAllTrees = document.getElementById('select-all-trees');
  const selectAllEquipment = document.getElementById('select-all-equipment');
  const totalDisplay = document.getElementById('total-selected');

  function updateTotal() {
    let total = 0;
    document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
      const item = cb.closest('div');
      const priceText = item.querySelector('p').innerText.replace('‡∏£‡∏≤‡∏Ñ‡∏≤: ‡∏ø', '');
      const quantity = parseInt(item.querySelector('span').innerText.trim());
      total += parseFloat(priceText) * quantity;
    });
    totalDisplay.textContent = '‡∏ø' + total.toFixed(2);
  }

  treeCheckboxes.forEach(cb => cb.addEventListener('change', updateTotal));
  equipmentCheckboxes.forEach(cb => cb.addEventListener('change', updateTotal));
  selectAllTrees.addEventListener('change', () => {
    treeCheckboxes.forEach(cb => cb.checked = selectAllTrees.checked);
    updateTotal();
  });
  selectAllEquipment.addEventListener('change', () => {
    equipmentCheckboxes.forEach(cb => cb.checked = selectAllEquipment.checked);
    updateTotal();
  });
</script>
{% endblock %}