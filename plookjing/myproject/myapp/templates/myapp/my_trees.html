{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 py-10 font-[Prompt]">
  <h1 class="text-3xl font-bold text-green-800 mb-6">üå≥ ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h1>

  <!-- üîÑ ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
  <div class="flex gap-3 mb-6">
    {% for s in ['‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏•‡∏π‡∏Å', '‡∏õ‡∏•‡∏π‡∏Å‡πÅ‡∏•‡πâ‡∏ß', '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'] %}
      <a href="?status={{ s }}" class="px-4 py-2 rounded-full text-sm font-medium
        {% if request.GET.status == s or (not request.GET.status and s == '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î') %}
          bg-green-600 text-white
        {% else %}
          bg-gray-200 text-gray-700 hover:bg-green-100
        {% endif %}">
        {{ s }}
      </a>
    {% endfor %}
  </div>

  {% if trees %}
    <div class="grid gap-6">
      {% for tree in trees %}
        <div class="bg-white shadow rounded-xl p-6 flex justify-between items-center">
          <div>
            <div class="text-lg font-semibold text-green-700">{{ tree.name }}</div>
            <div class="text-sm text-gray-600">üìç {{ tree.location_name }}</div>
            <div class="text-sm text-gray-600">üóìÔ∏è {{ tree.order_date|date:"d M Y" }}</div>
            <div class="text-sm mt-1">
              <span class="inline-block px-3 py-1 rounded-full text-white text-xs font-medium
                {% if tree.status == '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏•‡∏π‡∏Å' %} bg-yellow-500
                {% elif tree.status == '‡∏õ‡∏•‡∏π‡∏Å‡πÅ‡∏•‡πâ‡∏ß' %} bg-green-600
                {% elif tree.status == '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' %} bg-red-500
                {% endif %}">
                {{ tree.status }}
              </span>
            </div>
          </div>
          <!-- üëÅÔ∏è‚Äçüó®Ô∏è ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î -->
          <button onclick="openModal('modal-{{ tree.id }}')" class="text-orange-600 hover:underline">
            ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
          </button>
        </div>

        <!-- üîç Modal ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î -->
        <div id="modal-{{ tree.id }}" class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center z-50">
          <div class="bg-white rounded-xl p-6 max-w-lg w-full">
            <h2 class="text-xl font-bold text-green-700 mb-4">üå≥ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ</h2>
            <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> {{ tree.name }}</p>
            <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏π‡∏Å:</strong> {{ tree.location_name }}</p>
            <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:</strong> {{ tree.order_date|date:"d M Y" }}</p>
            <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> {{ tree.status }}</p>
            {% if tree.slip_url %}
              <p class="mt-2"><strong>‡∏™‡∏•‡∏¥‡∏õ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</strong> 
                <a href="{{ tree.slip_url.url }}" target="_blank" class="text-blue-500 underline">‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ</a>
              </p>
            {% endif %}
            <div class="mt-4 text-right">
              <button onclick="closeModal('modal-{{ tree.id }}')" class="text-red-500 hover:underline">‡∏õ‡∏¥‡∏î</button>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-gray-600">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏π‡∏Å</p>
  {% endif %}
</div>

<!-- ‚úÖ Script modal -->
<script>
  function openModal(id) {
    document.getElementById(id).classList.remove('hidden');
    document.getElementById(id).classList.add('flex');
  }
  function closeModal(id) {
    document.getElementById(id).classList.add('hidden');
    document.getElementById(id).classList.remove('flex');
  }
</script>
{% endblock %}