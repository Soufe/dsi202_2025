{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 py-10 font-[Prompt]">
  <h1 class="text-3xl font-bold text-green-800 mb-6">üì¶ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h1>

  <!-- üîç ‡πÅ‡∏ñ‡∏ö‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
  <div class="flex gap-3 mb-6">
    {% for status in ['‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á', '‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß', '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'] %}
      <a href="?status={{ status }}" class="px-4 py-2 rounded-full text-sm font-medium
        {% if request.GET.status == status or (not request.GET.status and status == '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î') %}
          bg-orange-600 text-white
        {% else %}
          bg-gray-200 text-gray-700 hover:bg-orange-100
        {% endif %}">
        {{ status }}
      </a>
    {% endfor %}
  </div>

  {% if orders %}
    <div class="grid gap-6">
      {% for order in orders %}
        <div class="bg-white shadow rounded-xl p-6 flex justify-between items-center">
          <div class="flex items-center gap-4">
            <img src="{{ order.first_item_image.url }}" alt="‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" class="w-20 h-20 rounded-xl object-cover">
            <div>
              <div class="font-semibold text-green-800">{{ order.name }}</div>
              <div class="text-sm text-gray-600">üõí {{ order.total_items }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
              <div class="text-sm text-gray-600">üóìÔ∏è {{ order.date|date:"d M Y" }}</div>
              <div class="mt-1">
                <span class="inline-block px-3 py-1 rounded-full text-white text-xs font-medium
                  {% if order.status == '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' %} bg-yellow-500
                  {% elif order.status == '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á' %} bg-blue-500
                  {% elif order.status == '‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß' %} bg-green-600
                  {% elif order.status == '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' %} bg-red-500
                  {% endif %}">
                  {{ order.status }}
                </span>
              </div>
            </div>
          </div>

          <!-- üîç ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î -->
          <button onclick="openModal('modal-{{ order.id }}')" class="text-orange-600 hover:underline">
            ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
          </button>
        </div>

        <!-- üìã Modal ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ -->
        <div id="modal-{{ order.id }}" class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center z-50">
          <div class="bg-white rounded-xl p-6 max-w-xl w-full relative">
            <h2 class="text-xl font-bold text-green-700 mb-4">üßæ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>
            <p><strong>‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:</strong> #{{ order.id }}</p>
            <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> {{ order.date|date:"d M Y" }}</p>
            <p><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á:</strong> {{ order.address }}</p>
            <p><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</strong> {{ order.tel }}</p>
            <div class="my-4 border-t pt-4">
              <h3 class="text-lg font-semibold text-orange-700 mb-2">üõçÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
              {% for item in order.items %}
                <div class="flex justify-between text-sm mb-1">
                  <span>{{ item.name }} x{{ item.quantity }}</span>
                  <span>{{ item.price|floatformat:2 }} ‡∏ö‡∏≤‡∏ó</span>
                </div>
              {% endfor %}
              <div class="flex justify-between font-semibold mt-2 text-green-800">
                <span>‡∏£‡∏ß‡∏°</span>
                <span>{{ order.total_price|floatformat:2 }} ‡∏ö‡∏≤‡∏ó</span>
              </div>
            </div>

            {% if order.slip_url %}
              <p><strong>‡∏™‡∏•‡∏¥‡∏õ:</strong> <a href="{{ order.slip_url.url }}" target="_blank" class="text-blue-600 underline">‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ</a></p>
            {% endif %}

            <div class="mt-6 text-right">
              <button onclick="closeModal('modal-{{ order.id }}')" class="text-red-600 hover:underline">‡∏õ‡∏¥‡∏î</button>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-gray-600">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p>
  {% endif %}
</div>

<!-- ‚úÖ Script modal -->
<script>
  function openModal(id) {
    document.getElementById(id).classList.remove('hidden');
    document.getElementById(id).classList.add('flex');
  }
  function closeModal(id) {
    document.getElementById(id).classList.add('hidden');
    document.getElementById(id).classList.remove('flex');
  }
</script>
{% endblock %}